class Snake {
	// è¡¨ç¤ºè›‡å¤´å…ƒç´ 
	head: HTMLElement
	// è¡¨ç¤ºè›‡èº«å…ƒç´ ï¼ˆåŒ…æ‹¬è›‡å¤´ï¼‰
	body: HTMLCollection
	// è·å–è›‡å®¹å™¨
	snakeContainer: HTMLElement

	// ç»™ head å’Œ body èµ‹å€¼
	constructor(){
		// è›‡å®¹å™¨
		this.snakeContainer = document.getElementById('snake')!
		// è›‡ä¸‹çš„ç¬¬ä¸€ä¸ªdivä¸ºè›‡å¤´ ï¼ˆquerySelectoråªä¼šå–åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å…ƒç´ ) å¹¶ç›´æ¥æ–­è¨€ä¸ºHTMLElement
		this.head = document.querySelector('#snake>div') as HTMLElement
		// è›‡å®¹å™¨ä¸‹çš„æ‰€æœ‰divä¸ºæ•´æ¡è›‡ï¼ˆåŒ…æ‹¬è›‡å¤´ï¼‰
		this.body = this.snakeContainer.getElementsByTagName('div')
	}

	// è·å–è›‡çš„åæ ‡ ï¼ˆå…¶å®å°±æ˜¯å¤´çš„åæ ‡ï¼‰
	// xè½´åæ ‡
	get snakeX():number{
		return this.head.offsetLeft
	}
	// yè½´åæ ‡
	get snakeY():number{
		return this.head.offsetTop
	}

	// æ›´æ”¹è›‡å¤´çš„åæ ‡ï¼ˆè¿™ä¸ªè·Ÿäº‹ä»¶æœ‰å…³ç³»ï¼Œéœ€è¦è§¦å‘äº‹ä»¶å»æ›´æ”¹è›‡çš„åæ ‡ï¼‰
	/* 
		æ³¨æ„è›‡å¤´çš„åæ ‡èŒƒå›´ï¼š
		1. x,yè½´åæ ‡ä¸èƒ½è¶…è¿‡æ¸¸æˆstageèŒƒå›´ï¼ˆ0-290ï¼‰
		2. åæ ‡å‡ä¸º10çš„å€æ•°
		3. åæ ‡ä¸ºéšæœºç”Ÿæˆ Math.random 
		4. åœ¨æœ¬æ¸¸æˆä¸­ï¼Œè›‡æ¯æ¬¡ç§»åŠ¨å…¶å®åªä¼šç§»åŠ¨xæˆ–yå…¶ä¸­ä¸€ä¸ªå€¼ï¼Œè€Œä¸ä¼šåŒæ—¶ä¿®æ”¹xå’Œyï¼ˆè›‡ä¸ä¼šæ–œç€èµ°ï¼‰
 	*/
	set snakeX(newX:number){
		// ä¼ å…¥çš„newXå€¼ === åŸæ¥çš„xå€¼å°±ä¸éœ€è¦å†å¾€ä¸‹æ‰§è¡Œï¼Œè›‡æ¯æ¬¡åªç§»åŠ¨xæˆ–è€…ç§»åŠ¨y
		if(this.snakeX === newX) return 
		// æ ¡éªŒnewXçš„èŒƒå›´æ˜¯å¦åˆæ³•, ç¬¦åˆæ‰å¯ä»¥ä¿®æ”¹ï¼Œå¦åˆ™å°±æ˜¯è›‡æ’å¢™äº†
		if (newX < 0 || newX > 290){
			// è›‡æ’å¢™ æ¸¸æˆç»“æŸ
			throw new Error('ğŸ hitted the wall! GAME OVER!!!!!')
		}

		// ç¦æ­¢æ°´å¹³æ–¹å‘ä¸Šæ‰å¤´
		/* 
			å¦‚ä½•åˆ¤æ–­è›‡æ‰å¤´äº†ï¼Ÿ
			- (è¿™æ—¶è›‡åœ¨å·¦å³ç§»åŠ¨ï¼Œåªæœ‰xè½´åæ ‡åœ¨åŠ¨ï¼Œyè½´åæ ‡æ˜¯ä¸åŠ¨çš„)ï¼Œå¦‚æœä¼ è¿›æ¥çš„æ–°xåæ ‡ï¼ˆå³ç¬¬ä¸€èŠ‚æ–°çš„è›‡å¤´xåæ ‡ï¼‰ä¸bodyçš„ç¬¬äºŒèŠ‚xåæ ‡ä¸€è‡´äº† => è¯æ˜è›‡åœ¨å¾€å›èµ°
			- æ³¨æ„æ’é™¤åªæœ‰ä¸€ä¸ªè›‡å¤´æ—¶çš„æƒ…å†µï¼ˆåªæœ‰è›‡å¤´æ—¶æ˜¯å¯ä»¥éšä¾¿ç§»åŠ¨çš„ï¼‰
		*/
		if (this.body.length > 1 && (this.body[1]as HTMLElement).offsetLeft === newX){
			// this.body.length > 1 å°†åªæœ‰è›‡å¤´çš„è¿™ä¸ªæƒ…å†µç»™æ’å‡ºåœ¨å¤–ï¼Œæˆ–ä¹Ÿå¯ä»¥å†™æˆ this.body[1] => å³æœ‰è›‡çš„ç¬¬äºŒèŠ‚èº«ä½“çš„æƒ…å†µ
			// console.log('è›‡åœ¨æ°´å¹³æ–¹å‘ä¸Šæ‰å¤´');
			// å¦‚æœå‘ç”Ÿäº†æ‰å¤´ï¼Œè®©è›‡å¾€åæ–¹å‘ï¼ˆåŸæ¥çš„æ–¹å‘ï¼‰ç»§ç»­ç§»åŠ¨ï¼Œæ³¨æ„å¾€å³èµ°æ˜¯xå¢å¤§ï¼Œå¾€å·¦èµ°æ˜¯xå‡å°
			if(newX > this.snakeX){
				// å¦‚æœæ˜¯åœ¨å‘å·¦èµ°çš„è¿‡ç¨‹ä¸­å‘å³æ‰å¤´çš„æƒ…å†µï¼ˆä¼ å…¥çš„newXå°±ä¼šå¤§äºåŸæ¥çš„è›‡å¤´ä½ç½®ï¼‰ 
				newX = this.snakeX - 10 // æ–°çš„ä½ç½® = è›‡å¤´åŸæ¥çš„ä½ç½® - 10 => å®ç°ç¦æ­¢æ‰å¤´ï¼Œç»§ç»­å¾€å·¦èµ°
			} else {
				// åä¹‹å¦‚æœæ˜¯åœ¨å‘å³èµ°çš„è¿‡ç¨‹ä¸­ï¼Œå¾€å·¦æ‰å¤´ï¼Œä¼ å…¥çš„newXå°±ä¼šå°äºåŸæ¥çš„ä½ç½®
				newX = this.snakeX + 10 // å¢å¤§ä¼ å…¥newXåæ ‡ï¼Œç»§ç»­å‘å³èµ°
			}
		}

		// ç§»åŠ¨èº«ä½“
		this.moveBody()
		// æ›´æ–°è›‡å¤´çš„Xåæ ‡
		this.head.style.left = newX + 'px'
		// åœ¨è›‡å¤´çš„åæ ‡æ›´æ–°ä¹‹åï¼Œåˆ¤æ–­è›‡å¤´æœ‰æ— æ’åˆ°è‡ªå·±èº«ä½“
		this.checkHeadBody()
	}
	
	set snakeY(newY:number){
		// åŒx
		if (this.snakeY === newY) return 
		// æ ¡éªŒnewXçš„èŒƒå›´æ˜¯å¦åˆæ³•, ç¬¦åˆæ‰å¯ä»¥ä¿®æ”¹ï¼Œå¦åˆ™å°±æ˜¯è›‡æ’å¢™äº†
		if (newY < 0 || newY > 290){
			// è›‡æ’å¢™ æ¸¸æˆç»“æŸ
			throw new Error('è›‡æ’å¢™äº†')
		}

		// ç¦æ­¢å‚ç›´æ–¹å‘ä¸Šçš„æ‰å¤´ (åŸç†åŒç¦æ­¢æ°´å¹³æ–¹å‘æ‰å¤´)
		if (this.body.length > 1 && (this.body[1]as HTMLElement).offsetTop === newY){
			if(newY > this.snakeY){
				newY = this.snakeY - 10
			} else {
				newY = this.snakeY + 10
			}
		}
		// å…ˆç§»åŠ¨èº«ä½“å†ç§»åŠ¨å¤´ï¼ˆä»åå¾€å‰ç§»ï¼Œæœ€åç§»åŠ¨å¤´ï¼Œå¦‚æœå…ˆç§»åŠ¨å¤´å†ç§»åŠ¨èº«ä½“ï¼Œåˆ™ä¼šç¬¬äºŒèŠ‚èº«ä½“ä¸è›‡å¤´åæ ‡é‡å ï¼‰
		this.moveBody()
		// æ›´æ–°è›‡å¤´çš„Yåæ ‡
		this.head.style.top = newY + 'px'
		// åœ¨è›‡å¤´çš„åæ ‡æ›´æ–°ä¹‹åï¼Œåˆ¤æ–­è›‡å¤´æœ‰æ— æ’åˆ°è‡ªå·±èº«ä½“
		this.checkHeadBody()
	}

	// åƒäº†é£Ÿç‰©ä¹‹åä¼šå¢åŠ ä¸€æ ¼è›‡body
	/* 
		ï¼ï¼insertAdjacentHTML() æ–¹æ³•å°†æŒ‡å®šçš„æ–‡æœ¬è§£æä¸º Element å…ƒç´ ï¼Œå¹¶å°†ç»“æœèŠ‚ç‚¹æ’å…¥åˆ° DOM æ ‘ä¸­çš„æŒ‡å®šä½ç½®ã€‚
		è¯­æ³•ï¼šelement.insertAdjacentHTML(position, text);
		position => å…ƒç´ éœ€è¦æ·»åŠ åˆ°ä»€ä¹ˆä½ç½®
		text => HTMLå…ƒç´ text
		å‚è€ƒï¼š https://developer.mozilla.org/zh-CN/docs/Web/API/Element/insertAdjacentHTML
	*/
	addBody(){
		// å‘è›‡å®¹å™¨ä¸­æ·»åŠ div(åŠ åˆ°snakeå®¹å™¨çš„æœ€åï¼Œå³beforeend)
		this.snakeContainer.insertAdjacentHTML('beforeend', '<div></div>')
	}

	// æ·»åŠ ä¸€ä¸ªæ•´æ¡è›‡ç§»åŠ¨çš„æ–¹æ³•
	/* 
		æ³¨æ„ï¼šä»åå¾€å‰ç§»åŠ¨ï¼Œä»æœ€åä¸€èŠ‚å¾€å‰ç§»ï¼Œå¦åˆ™è›‡ä¼šæ–­å¼€ã€‚ã€‚ã€‚ 
		åŸåˆ™ï¼šåé¢ä¸€èŠ‚æ‰¾åˆ°å‰é¢ä¸€èŠ‚çš„ä½ç½®ï¼Œåé¢ä¸€èŠ‚ç§»åŠ¨åˆ°å‰é¢ä¸€èŠ‚çš„ä½ç½®ï¼Œä¸€èŠ‚ä¸€èŠ‚å¾€å‰ç§»	
	*/
	moveBody(){
		// éå†æ‰€æœ‰èº«ä½“ï¼ˆä»åå¾€å‰éå†ï¼‰å¤´ä¸éœ€è¦æ”¹ï¼Œå› ä¸ºå‰é¢å•ç‹¬è®¾äº†è›‡å¤´ä½ç½®çš„æ›´é«˜æ–¹æ³•
		// ä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼Ÿåœ¨è›‡å¤´ç§»åŠ¨çš„åŒæ—¶ç§»åŠ¨èº«ä½“ï¼Œåœ¨setterå†…è°ƒ
		// for å¾ªç¯ä»æœ€åä¸€èŠ‚å¾€å‰éå†ï¼Œ iä¸ºindexï¼Œæœ€åä¸€ä½çš„indexä¸ºbody.length - 1, æ³¨æ„ä¸æ˜¯body.length
		for(let i = this.body.length - 1; i > 0; i--){
			// è·å–å‰é¢ä¸€èŠ‚èº«ä½“çš„ä½ç½®
			let X = (this.body[i-1] as HTMLElement).offsetLeft;
			let Y = (this.body[i-1] as HTMLElement).offsetTop;
			// å°†è¯¥x y è®¾ç½®ç»™å½“å‰çš„ä¸€èŠ‚è›‡èº«(å³åä¸€èŠ‚),ä½¿åé¢çš„ä¸€èŠ‚è›‡èº«å¾€å‰é¢ä¸€èŠ‚çš„ä½ç½®ç§»åŠ¨(è®°å¾—åŠ â€˜pxâ€™ï¼Œå°†numberè½¬ä¸ºstring)
			(this.body[i] as HTMLElement).style.left = X +'px';
			(this.body[i] as HTMLElement).style.top = Y +'px';
		}
	}

	// æ£€æŸ¥å¤´å’Œèº«ä½“åæ ‡æœ‰æ— é‡åˆï¼ˆè›‡æ˜¯å¦æ’è‡ªå·±ï¼‰
	checkHeadBody(){
		// è·å–æ‰€æœ‰èº«ä½“ï¼Œæ£€æŸ¥æ˜¯å¦ä¸è›‡å¤´çš„åæ ‡é‡åˆ
		for(let i = 1; i < this.body.length; i++){
			// ä»ç¬¬äºŒèŠ‚å¼€å§‹éå†ï¼Œç¬¬ä¸€èŠ‚ä¸ºè›‡å¤´
			// è·å–æ¯ä¸€èŠ‚çš„ X,Yåæ ‡
			let X  = (this.body[i] as HTMLElement).offsetLeft
			let Y  = (this.body[i] as HTMLElement).offsetTop
			// æ¯ä¸€èŠ‚body(å¯ä»¥ç®€åŒ–code)
			// let body = this.body[i] as HTMLElement
			if(this.snakeX === X  && this.snakeY === Y){
				// ç›¸æ’äº†ï¼Œé€šçŸ¥GameControlæ¸¸æˆç»“æŸ
				throw new Error('ğŸ hitted itself! GAME OVER!!!!!')
			}
		}
	}
}


// å°ç»†èŠ‚é—®é¢˜ï¼š
/* 
	1. è›‡ç§»åŠ¨çš„é¡ºåºï¼Œä»åå¾€å‰ç§»åŠ¨ï¼Œæœ€åç§»åŠ¨å¤´
	2. ç¦æ­¢è›‡æ‰å¤´ => è›‡åœ¨å‘å·¦ç§»åŠ¨æ—¶ä¸èƒ½å¾€å³èµ°ï¼ˆæŒ‰é”®ä¸èƒ½æ˜¯ArrowRightï¼‰ï¼Œå…¶ä»–æ–¹å‘åŒç†
	3. è›‡ç¢°åˆ°è‡ªå·±èº«ä½“åˆ™æ¸¸æˆåœæ­¢ => æ£€æŸ¥è›‡å¤´çš„åæ ‡æœ‰æ— è·Ÿè›‡èº«ä½“çš„åæ ‡é‡åˆ
*/

export default Snake